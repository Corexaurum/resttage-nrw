<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Resttage NRW</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ffffff">

  <!-- iOS PWA -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root {
      --border: #e5e5e5;
      --muted: #666;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #fafafa;
    }
    h1 {
      margin-top: 0;
    }
    .muted {
      color: var(--muted);
    }
    .card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .big {
      font-size: 36px;
      font-weight: 700;
      margin-top: 6px;
    }
    label {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    ul {
      padding-left: 18px;
    }
    li {
      margin: 6px 0;
    }
  </style>
</head>

<body>
  <h1>Resttage bis Jahresende (NRW)</h1>
  <p class="muted" id="meta">–</p>

  <div class="card">
    <label>
      <input type="checkbox" id="includeToday" checked>
      Heute mitzählen
    </label>
    <label>
      <input type="checkbox" id="includeHolidays" checked>
      NRW-Feiertage abziehen (nur Werktage)
    </label>
  </div>

  <div class="card">
    <div>Kalendertage bis 31.12.</div>
    <div class="big" id="calendarDays">–</div>
  </div>

  <div class="card">
    <div>Arbeitstage bis 31.12.</div>
    <div class="big" id="workDays">–</div>
    <p class="muted" id="workDaysInfo">–</p>
  </div>

  <div class="card">
    <strong>Verbleibende Feiertage in NRW</strong>
    <ul id="holidayList"></ul>
  </div>

<script>
/* ---------- helpers ---------- */
function startOfDay(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); return x; }
function isWeekend(d){ return d.getDay()===0 || d.getDay()===6; }
function fmt(d){ return new Intl.DateTimeFormat("de-DE",{dateStyle:"full"}).format(d); }

/* ---------- easter ---------- */
function easterSunday(year){
  const a=year%19,b=Math.floor(year/100),c=year%100;
  const d=Math.floor(b/4),e=b%4,f=Math.floor((b+8)/25);
  const g=Math.floor((b-f+1)/3),h=(19*a+b-d-g+15)%30;
  const i=Math.floor(c/4),k=c%4,l=(32+2*e+2*i-h-k)%7;
  const m=Math.floor((a+11*h+22*l)/451);
  const month=Math.floor((h+l-7*m+114)/31);
  const day=((h+l-7*m+114)%31)+1;
  return new Date(year,month-1,day);
}

/* ---------- NRW holidays ---------- */
function nrwHolidays(year){
  const easter=easterSunday(year);
  return [
    ["Neujahr", new Date(year,0,1)],
    ["Karfreitag", addDays(easter,-2)],
    ["Ostermontag", addDays(easter,1)],
    ["Tag der Arbeit", new Date(year,4,1)],
    ["Christi Himmelfahrt", addDays(easter,39)],
    ["Pfingstmontag", addDays(easter,50)],
    ["Fronleichnam", addDays(easter,60)],
    ["Tag der Deutschen Einheit", new Date(year,9,3)],
    ["Allerheiligen", new Date(year,10,1)],
    ["1. Weihnachtstag", new Date(year,11,25)],
    ["2. Weihnachtstag", new Date(year,11,26)]
  ].map(x => ({ name:x[0], date:startOfDay(x[1]) }))
   .sort((a,b)=>a.date-b.date);
}

/* ---------- main ---------- */
function render(){
  const includeToday = includeTodayEl.checked;
  const includeHolidays = includeHolidaysEl.checked;

  const today = startOfDay(new Date());
  const year = today.getFullYear();
  const end = new Date(year,11,31);
  const start = includeToday ? today : addDays(today,1);

  meta.textContent = `Von ${fmt(today)} bis ${fmt(end)}`;

  /* calendar days */
  const calDays = start>end ? 0 : Math.round((end-start)/(86400000))+1;
  calendarDays.textContent = calDays;

  /* workdays */
  let weekdays = 0;
  for(let d=new Date(start); d<=end; d=addDays(d,1)){
    if(!isWeekend(d)) weekdays++;
  }

  const holidays = nrwHolidays(year)
    .filter(h => h.date>=start && h.date<=end);

  const holidayWeekdays = holidays.filter(h=>!isWeekend(h.date)).length;
  const work = includeHolidays ? weekdays - holidayWeekdays : weekdays;

  workDays.textContent = work;
  workDaysInfo.textContent =
    includeHolidays
      ? `${weekdays} Werktage − ${holidayWeekdays} Feiertage`
      : `${weekdays} Werktage (Feiertage nicht abgezogen)`;

  holidayList.innerHTML = "";
  if(holidays.length===0){
    holidayList.innerHTML = "<li>Keine Feiertage mehr</li>";
  } else {
    for(const h of holidays){
      const li=document.createElement("li");
      li.textContent =
        `${h.name}: ${fmt(h.date)}` +
        (isWeekend(h.date) ? " (Wochenende)" : "");
      holidayList.appendChild(li);
    }
  }
}

/* ---------- init ---------- */
const includeTodayEl = document.getElementById("includeToday");
const includeHolidaysEl = document.getElementById("includeHolidays");
const meta = document.getElementById("meta");
const calendarDays = document.getElementById("calendarDays");
const workDays = document.getElementById("workDays");
const workDaysInfo = document.getElementById("workDaysInfo");
const holidayList = document.getElementById("holidayList");

includeTodayEl.onchange = render;
includeHolidaysEl.onchange = render;
render();

/* ---------- service worker ---------- */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}
</script>
</body>
</html>
